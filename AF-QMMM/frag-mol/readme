# by mshi
# To get the input file of calculation using the frag-mol program.

1. Prepared files

1.1 A supercell pdb file is needed. The 'newcell.pdb' is generated by the program 'supercell.f90'from the folder 'supercell' 

1.2 The 'fitting_charge.txt' file is needed.
    The 'fitting_charge.txt' file can be obtained from the 'mol2' file of a single molecule. While the 'mole2' file can be generated by the command 'antechamber', the specific usage of the command is 'antechamber -i xx.pdb -fi pdb -o xx.mol2 -fo mol2 -c bcc -nc 0 -s 2  -pf y'('xx' is the name of the pdb file).
1.3 The 'lgroup' file is needed. The fragments are defined in the input file. The first three numbers represent the number of atoms in each fragment, and the next number represents the atomic number under each fragment.

2. Usage

2.1 What needs attention and modification in the program.
 1) in the line 25 of the program 'frag-mol.f90', the 'lastprotres' is the total molecules of the supercell. Generally, if there are 'N' molecules in the unit cell and a 'm*n*l' supercell, then 'lastprotres = N*m*n*l'. (For example, there are 4 molecues in the unit cell of the crystal CIMETD, and a '5*5*5*' supercell is built, then the value of 'lastprotres' is 500.('lastprotres = 4*5*5*5')
 2) in the line 26 of the program 'frag-mol.f90', the 'molatom' is the number of atoms in a single molecule.
 3) in the line 27 of the program 'frag-mol.f90', the 'basename' is the based name of the input file, which occupies 4 characters.
 4) in the line 234 of the program 'frag-mol.f90', the '%mem' is the memory set in your Gaussian inputfile. You can modify it accordig to your machine.
 5) in the line 235 of the program 'frag-mol.f90', the '%nprocshared' is the number of cores for Gaussian calculation. You can set it according to your machine.
 6) in the line 237ï¼Œ238 of the program 'frag-mol.f90', the '#B3LYP/6-31g** charge nmr(printeigenvectors) nosymm &'
        'integral(grid=ultrafine)' is the key word and method using in Gaussian calculation.

2.2 Compile the program using the command 'ifort frag-mol.f90' or 'gfortran frag-mol.f90'And then an executable file 'a.out' is generated.

2.3 Execut the program. You can run the program using the command './a.out'. After that the 'lastprotres' fragments files will be obtained. ('xxx.com' and 'xxx.pqr') The 'xxx.com' file is the input file of Gaussian, while the 'xxx.pqr' is the file which records detailed information of the atoms and there coordinations.

3. Calculate the Gaussian file
   After get the files of fragments, you can only calculate the fragments in the central unit cell using the command 'g09 xxx.com'. For example, to calculate the chemical shift of the crystal CIMETD, only the fragments in the central unit cell are needed to be calculated, therefore, the command is 'g09 CITD249_1.com', 'g09 CITD249_2', 'g09 CITD249_3',  'g09 CITD250_1.com', 'g09 CITD250_2', 'g09 CITD250_3', 'g09 CITD251_1.com', 'g09 CITD251_2.com', 'g09 CITD251_3.com', 'g09 CITD252_1.com', 'g09 CITD252_2.com', 'g09 CITD252_3.com'(in total 12 fragments, because there are 4 molecules in the unit cell, and every central molecule is divided into 3 fragments, where 1, 2, 3 stands for the three fragments of each molecule).Each fragment only needs to take out the value of the atom in its core region. Four results obtained, and then averaged to get the chemical shifts of the crystal. (For example, for crystal CIMETD, whose central molecule is divided into three molecules, in first fragment, there are 11 atoms, and the chemical shifts of these 11 atoms can be get through the 4 output files of xxx_1.log, then averaged. The values of other atoms are calculated like this. In this way, the chemical shifts of all atoms can be obtained.)

